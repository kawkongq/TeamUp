generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                  String            @id @default(cuid())
  email               String            @unique
  name                String?
  passwordHash        String
  role                String            @default("user")
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  chatsReceived       Chat[]            @relation("ChatReceiver")
  chatsSent           Chat[]            @relation("ChatSender")
  matchesB            Match[]           @relation("UserB")
  matchesA            Match[]           @relation("UserA")
  messages            Message[]         @relation("MessageSender")
  profile             Profile?
  swipedBy            Swipe[]           @relation("UserSwipee")
  swipes              Swipe[]           @relation("UserSwiper")
  ownedTeams          Team[]            @relation("TeamOwner")
  joinRequests        TeamJoinRequest[]
  teamMembers         TeamMember[]
  sentInvitations     TeamInvitation[]  @relation("InvitationSender")
  receivedInvitations TeamInvitation[]  @relation("InvitationReceiver")
}

model Profile {
  id                String            @id @default(cuid())
  userId            String            @unique
  displayName       String
  bio               String?
  role              String?
  avatar            String?
  location          String?
  experience        String?
  hourlyRate        Float?
  availability      String?
  timezone          String?
  links             Json?
  rating            Float?            @default(0)
  projectsCompleted Int?              @default(0)
  isAvailable       Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @default(now()) @updatedAt
  user              User              @relation(fields: [userId], references: [id])
  interests         ProfileInterest[]
  skills            ProfileSkill[]
  projects          Project[]
  socialLinks       SocialLink[]
}

model Skill {
  id       Int            @id @default(autoincrement())
  name     String         @unique
  category String?
  icon     String?
  profiles ProfileSkill[]
}

model Interest {
  id       Int               @id @default(autoincrement())
  name     String            @unique
  category String?
  icon     String?
  profiles ProfileInterest[]
}

model ProfileSkill {
  profileId         String
  skillId           Int
  level             Int     @default(1)
  yearsOfExperience Int     @default(0)
  skill             Skill   @relation(fields: [skillId], references: [id])
  profile           Profile @relation(fields: [profileId], references: [id])

  @@id([profileId, skillId])
}

model ProfileInterest {
  profileId  String
  interestId Int
  level      Int      @default(1)
  interest   Interest @relation(fields: [interestId], references: [id])
  profile    Profile  @relation(fields: [profileId], references: [id])

  @@id([profileId, interestId])
}

model SocialLink {
  id       String  @id @default(cuid())
  userId   String
  platform String
  url      String
  isPublic Boolean @default(true)
  profile  Profile @relation(fields: [userId], references: [id])
}

model Project {
  id           String    @id @default(cuid())
  userId       String
  title        String
  description  String?
  imageUrl     String?
  githubUrl    String?
  liveUrl      String?
  technologies String
  completedAt  DateTime?
  isPublic     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  profile      Profile   @relation(fields: [userId], references: [id])
}

model Swipe {
  id        String         @id @default(cuid())
  swiperId  String
  swipeeId  String
  direction SwipeDirection
  createdAt DateTime       @default(now())
  swipee    User           @relation("UserSwipee", fields: [swipeeId], references: [id])
  swiper    User           @relation("UserSwiper", fields: [swiperId], references: [id])

  @@unique([swiperId, swipeeId])
}

model Match {
  id        String   @id @default(cuid())
  userAId   String
  userBId   String
  createdAt DateTime @default(now())
  userB     User     @relation("UserB", fields: [userBId], references: [id])
  userA     User     @relation("UserA", fields: [userAId], references: [id])

  @@unique([userAId, userBId])
}

model Chat {
  id         String    @id @default(cuid())
  senderId   String
  receiverId String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  receiver   User      @relation("ChatReceiver", fields: [receiverId], references: [id])
  sender     User      @relation("ChatSender", fields: [senderId], references: [id])
  messages   Message[]

  @@unique([senderId, receiverId])
}

model Message {
  id          String      @id @default(cuid())
  chatId      String
  senderId    String
  content     String
  messageType MessageType @default(TEXT)
  isRead      Boolean     @default(false)
  createdAt   DateTime    @default(now())
  sender      User        @relation("MessageSender", fields: [senderId], references: [id])
  chat        Chat        @relation(fields: [chatId], references: [id])
}

model Event {
  id            String              @id @default(cuid())
  name          String
  description   String?
  type          String
  category      String?
  tags          String? // JSON array of tags
  startDate     DateTime
  endDate       DateTime
  location      String?
  imageUrl      String?
  maxTeams      Int?
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  teams         Team[]
  registrations EventRegistration[]
  timeline      EventTimeline[]
  resources     EventResource[]
}

model EventRegistration {
  id        String             @id @default(cuid())
  eventId   String
  teamId    String
  status    RegistrationStatus @default(PENDING)
  message   String?
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  event     Event              @relation(fields: [eventId], references: [id])
  team      Team               @relation(fields: [teamId], references: [id])

  @@unique([eventId, teamId])
}

model EventTimeline {
  id          String   @id @default(cuid())
  eventId     String
  title       String
  description String?
  date        DateTime
  isCompleted Boolean  @default(false)
  createdAt   DateTime @default(now())
  event       Event    @relation(fields: [eventId], references: [id])
}

model EventResource {
  id          String       @id @default(cuid())
  eventId     String
  title       String
  description String?
  type        ResourceType
  url         String?
  fileUrl     String?
  createdAt   DateTime     @default(now())
  event       Event        @relation(fields: [eventId], references: [id])
}

enum RegistrationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ResourceType {
  LINK
  FILE
  DOCUMENT
  VIDEO
}

model Team {
  id            String              @id @default(cuid())
  name          String
  description   String
  eventId       String
  ownerId       String
  maxMembers    Int
  tags          String
  lookingFor    String
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  owner         User                @relation("TeamOwner", fields: [ownerId], references: [id])
  event         Event               @relation(fields: [eventId], references: [id])
  joinRequests  TeamJoinRequest[]
  members       TeamMember[]
  invitations   TeamInvitation[]
  registrations EventRegistration[]
}

model TeamMember {
  id       String   @id @default(cuid())
  teamId   String
  userId   String
  role     String
  joinedAt DateTime @default(now())
  isActive Boolean  @default(true)
  user     User     @relation(fields: [userId], references: [id])
  team     Team     @relation(fields: [teamId], references: [id])

  @@unique([teamId, userId])
}

model TeamJoinRequest {
  id        String        @id @default(cuid())
  teamId    String
  userId    String
  message   String?
  status    RequestStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  user      User          @relation(fields: [userId], references: [id])
  team      Team          @relation(fields: [teamId], references: [id])

  @@unique([teamId, userId])
}

model TeamInvitation {
  id         String        @id @default(cuid())
  teamId     String
  senderId   String
  receiverId String
  message    String?
  status     RequestStatus @default(PENDING)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  team       Team          @relation(fields: [teamId], references: [id])
  sender     User          @relation("InvitationSender", fields: [senderId], references: [id])
  receiver   User          @relation("InvitationReceiver", fields: [receiverId], references: [id])

  @@unique([teamId, receiverId])
}

enum SwipeDirection {
  LIKE
  PASS
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  SYSTEM
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}
